# 웹 프록시 툴
- 종류 : Paros, Burpsuit 등
- 정의
  - 웹 프록시 툴은 웹 서버와 웹 클라이언트 사이에 위치하여 웹 클라이언트에서 보내는 데이터를 받아 웹 서버로 중개하거나, 그 반대의 역할을 가능하도록 하는 툴
  - 해킹과 보안에서 해당 툴을 다루는 이유는 해당 툴을 이용해 웹 서버로 데이터를 수정해서 보내거나, 클라이언트가 보낸 요청에 대해 결과를 쉽게 얻을 수 있기 때문이다.
- Burpsuit 사용
  - Proxy ---> Options 에서 Intercept Client Requests에서 Or 부분들 체크
  - Proxy ---> Options 에서 Intercept Server Responses에서 Or 부분들 체크
  - Proxy ---> Intercept에서 Intercept is on과 off로 조절
  - 크롬에서 설정 ---> 프록시 설정 열기 ---> 연결 탭 ---> LAN 설정 ---> 프록시 서버 체크 ---> 127.0.0.1의 8080 포트 등록
  - 실습이 끝나면 해당 크롬 설정은 반드시 원상복구 할 것!
  - 만약 톰캣과 함께 사용할 경우 8080 포트가 겹칠 수 있으니 Proxy ---> Options 의 Listeners에서 포트 번호를 변경

### 간단한 실습
- http://suninatas.com/challenge/web04/web04.asp
- 문제 해설 : http://blog.naver.com/PostView.nhn?blogId=is_king&logNo=221418854654&categoryNo=75&parentCategoryNo=0&viewDate=&currentPage=1&postListTopCurrentPage=1&from=search
  - Burpsuit의 Proxy 탭의 Intercept에서 Intercept is on으로 설정해 두고 테스트
  - 4번 문제에서 Plus 버튼을 누른 후 User-Agent 부분을 보면 like Gecko 라고 적혀 있음
  - 포인트가 25가 넘어가면 Suninatas 브라우저가 좋다는 메세지가 얼럿으로 나옴
  - User-Agent 부분에 like Gecko를 like Suninatas로 변경
  - 이후 반복 작업을 위해 Proxy 탭의 HTTP history에서 최근에 보낸 POST 방식을 우클릭 ---> Send to Repeater 선택
  - Repeater 탭에 가서 User-Agent를 정답으로 바꿔 놓고 포인트가 50이 될때까지 Go 버튼을 누름
  - 50 포인트가 되면 실제 브라우저에서 새로고침

# 인증과 인가
- 인증 : 클라이언트가 자신이 주장하는 사용자와 같은 사용자 인지를 확인하는 과정
- 인가 : 권한 부여, 클라이언트가 하고자 하는 작업이 해당 클라이언트에게 허가된 작업인지를 확인
- 인증과 인가의 차이점 : 인증을 거친 후 인증된 사용자에 대한 특정한 권한을 부여하는 것이 인가 이다.
- 인증을 위해 세션이 필요한 이유
  - HTTP 통신은 클라이언트의 요청에 대한 응답 후 연결을 끊기 때문에 과거에 대한 정보를 전혀 담고 있지 않는다. (비연결성 = Connectionless 과 비상태성 = Stateless)
  - 즉, 지금 보낼 HTTP 요청은 지난 번에 내 정보를 담아 보냈던 HTTP 요청과 전혀 관계가 없다는 의미이다.
  - 따라서 각각의 HTTP 요청에는 주체가 누구인지에 대한 정보가 필수적이기 때문에 세션을 사용한다.
  
### 세션과 쿠키

### 세션을 사용하지 않는 HTTP 인증
- 특정 서비스를 이용할 때마다 사용자의 정보를 보내거나, 인증을 쿠키로 하는 경우 여러가지 취약점이 있다.
- 특정 서비스를 이용할 때마다 사용자의 정보를 보내는 경우에는 패킷 스니핑 등으로 사용자의 정보를 해커가 가로챌 수 있다.
- 인증을 쿠키로 사용하는 경우 XSS 공격과 함께 사용되면 치명적일 수 있다.
- 공격자는 XSS를 이용해 브라우저에 악성 script를 삽입한다.
  - 예를 들어 해당 악성 script는 사용자의 쿠키 정보를 얻어서 자신의 서버로 보내는 스크립트일 수 있다.
- 이후 사용자에게 얻은 쿠키 값을 바탕으로 해커는 자신의 쿠키 값을 변경하여 다른 사람으로 로그인할 수 있다.

### 세션을 사용하는 HTTP 인증
- spring 에서 session을 이용한 인증은 많이 해봤으므로 pass

### 간단한 실습
- http://suninatas.com/challenge/web06/web06.asp
  - SQL 인젝션과 쿠키 변조가 함께 있는 문제
- 문제 해설 : https://securitycode.tistory.com/32
  - 문제의 3번 글인 README를 읽으면 SQL 구문이 나온다. 이러한 점을 참고해 SQL 인젝션을 수행한다.
  - SQL 인젝션에 성공하면 auth_key is suninatastopofworld! 라는 문구가 나오지만 권한이 없다는 메세지도 함께 나온다.
  - 이를 해결하기 위해 Burpsuit을 이용해 3번 게시글을 인터셉터로 잡고 Cookie 부분을 살펴본다.
  - auth Key=%3F%3F%3F%3F로 인코딩 되어 있는데 이것을 위에서 얻은 auth_key인 suninatastopofworld! 를 인코딩 한 후 쿠키를 변경해준다.
  - 인코딩은 Burpsuit의 Decoder 탭에서 Hash 부분을 MD5로 설정해서 인코딩을 하고, 인코딩 결과를 Cookie의 auth Key 부분에 넣어준다.
  - 이후에 다시 SQL 인젝션을 수행한다.