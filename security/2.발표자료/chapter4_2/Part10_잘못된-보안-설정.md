# 잘못된 보안 설정
## 요약
시스템 설치 시 기본적으로 설치되는 불필요한 기능이나 환경 설정, 보안 설정을 수정하지 않고 사용하는 경우 기본 계정, 휴면 페이지, 패치되지 않은 결함 등에 따른 취약점이 존재할 수 있으며, 이런 취약점들은 취약점 점검 툴 등을 통해 쉽게 검출되어 공격에 사용되기도 한다.

<br>

## 디렉터리 리스팅
웹 서버 운영 시 특정 디렉터리에 디폴트 파일(index.html, default.html 등)이 없는 경우 해당 디렉터리의 파일 리스트를 브라우저로 보여주게 되는 취약점이다.

### 원인
웹 서버의 특정 디렉터리 요청에 대해 디폴트 페이지가 설정되어 있으나, 해당 페이지가 존재하지 않다면 요청한 디렉터리에 대한 목록이 보이도록 웹 서버가 설정되어 있는 경우

### 취약점 진단
- 디폴트 페이지 요청 시 디렉터리 목록이 출력되는지 확인한다.
   - URL 경로 중 확인하고자 하는 디렉터리까지만 주소 창에 입력하여 디렉터리 목록을 볼 수 있는지 확인
- 구글 검색을 통해 디렉터리 목록 정보를 얻을 수 있는지 확인한다.
   - `intitle:index of`, `parent Directory`, `부모 디렉토리로 이동` 등의 검색어 입력
- 웹 취약점 진단 도구를 사용하여 디렉터리 목록이 노출되는지 확인한다.
   - Paros 툴 이용

해결책은 다음과 같다.

- 디렉터리 리스팅 취약점 제거를 위한 톰캣 서버 설정
   - `web.xml`에서 디렉터리 리스팅 정책을 설정한다.
   ```xml
   <init-param>
        <param-name>listings</param-name>
        <param-value>false</param-value>
   </init-param>
   ```
- 디렉터리 리스팅 취약점 제거를 위한 아파치 서버 설정
   - `httpd.conf` 파일에서 <Directory> 설정에서 Options 값에 설정된 Indexes 속성을 None으로 변경한다.
   ```xml
   <Directory "/usr/local/apache2/htdocs">
        # Options Indexes FollowSymLinks
        Options None
        AllowOverride None
        Order allow,deny
        Allow from all
   </Directory>
   ```
- 디렉터리 리스팅 취약점 제거를 위한 IIS 서버 설정
   - `[제어판]-[관리도구]-[IIS(인터넷 서비스) 관리자]-[기능 보기]-[디렉터리 검색]` 화면에서 더블 클릭을 통해 [사용]을 [사용 안 함]으로 변경한다.

<br>

## 에러 노출
사용자의 요청을 처리하는 동안 예외가 발생했을 때 해당 예외를 애플리케이션이나 서버에서 충분히 처리하지 못한다면, 웹 서버는 예외가 발생한 상황의 스택 정보나 데이터베이스 에러 정보를 브라우저에 출력해 시스템 정보를 노출할 수 있다.

### 원인
프로그램에서 예외 처리에 대한 코드가 제대로 구현되지 않은 경우, 발생된 예외는 시스템에 전달된다. 이 경우 시스템의 디폴트 동작은 예외가 발생한 상황의 스택정보를 클라이언트인 브라우저로 출력하여 시스템 정보가 노출된다.

### 취약점 진단
- 입력값을 조작하여 에러메시지가 노출되는지 체크
- DB 쿼리에 사용되는 입력값을 조작하여 에러메시지가 노출되는지 체크
- 자동화 도구를 이용하여 에러메시지가 노출되는지 체크

해결책은 다음과 같다.

- 예외발생시 지정된 에러페이지가 사용자에게 응답되도록 설정
   - 톰캣 서버 설정
   - IIS 서버 설정
   - Apache 서버 설정
- SpringMVC 프레임워크
   - 설정 파일 사용하여 디폴트 에러페이지 설정
  - `@ControllerAdvice`를 이용하여 예외 처리 설정

<br>

## 디폴트 설정 노출
서버 설치시 기본적으로 설치되는 페이지나 기본적으로 설정되는 계정, 패스워드, 디렉터리, 백업 파일 등에 대한 정보들이 노출되는 경우, 공격자는 이 정보들을 활용하여 해당 시스템을 손쉽게 공격할 수 있다.

### 원인
불필요한 서비스, 페이지, 계정, 권한 등을 제거하지 않았거나 시스템 설치시 제공되는 기본 계정에 대해 암호 변경 및 사용 정지를 수행하지 않은 경우에 발생할 수 있다.

### 취약점 진단
- 시스템 설치 시 기본 설정된 패스워드가 사용 가능한 상태인지 확인
   - 시스템 설치 시 기본적으로 포함되는 관리자 콘솔이 제거되지 않았거나 패스워드 변경이 수행되지 않은 경우 시스템을 쉽게 공격할 수 있다.
   - 각 서버별 디폴트로 설치되는 관리자 페이지에 접속 가능한지 확인한다.

해결책은 다음과 같다.

- 불필요한 계정, 권한, 서비스, 페이지 삭제
   - 시스템 설치 후 불필요한 서비스나 페이지, 계정, 권한들을 모두 삭제한다. 특히 계정에 대해서는 LOCK을 설정하여 필요한 경우에만 LOCK을 해제해 사용하도록 한다.
   - 디폴트 설정 제거 및 축소 검토 목록: 기본 페이지 삭제, 불필요한 페이지 삭제, 불필요한 서비스 삭제, 관리자 계정 변경, 관리자 서비스 축소, 관리자 권한 축소

<br>

## 취약한 컴포넌트 사용
슈퍼 유저 권한으로 운영되는 취약한 라이브러리, 프레임워크, 기타 다른 소프트웨어 모듈로 인해 데이터 유실과 서버 권한 획득 같은 취약점이 발생하는 경우이다. 사용된 모든 컴포넌트들이 최신 패치가 적용된 상태가 아니기 때문에 항상 발생할 수 있는 취약점이며, 개발자들은 자신들이 사용하는 내부 컴포넌트에 대해 인지하지 못하는 경우도 있다.

### 원인
취약점 정보를 취득하지 않거나 취약점 관리 프로젝트의 발표 내용 등을 확인하지 않고 사용하는 경우, 소스 코드에서 취약점이 있는 컴포넌트를 사용하고 있는지 여부와 그 영향을 실시간으로 파악하지 못하는 경우에 발생한다.

### 취약점 진단
관리자는 자신이 운영하는 시스템에서 사용하는 컴포넌트들에 대한 정보를 리스트화해서 관리해야 하며 실시간으로 보안 패치가 적용될 수 있도록 해야 한다.

- Apache CXF 요소 검사 보안 우회 취약점을 이용한 공격 허용 여부 체크 예
   - Apache CXF의 경우, 지원 토큰의 자식으로 정책들이 지정될 때 해당 애플리케이션이 특정 토큰에 의해 서명된 경우 암호화된 요소들을 적절히 검사하지 못하는 취약점이 발견되었다.

이에 대한 해결책은 다음과 같다.

- Apache CXF 요소 검사 보안 우회 취약점 제거를 위한 버전 업데이트

Struts2의 특정 매개변수 처리 취약점도 있는데, 마찬가지로 버전 업데이트로 해결할 수 있다.

외부에서 작성된 컴포넌트를 사용하지 않는 것이 가장 좋은 방법이지만, 현실적으로는 사용 중인 컴포넌트들에 대해 최신 업데이트를 유지하는 것이 중요하다. 또한, 오픈소스 프로젝트의 경우 취약점 패치를 제공하지 않는 경우가 많으므로 보안상의 위험이 크다는 것을 염두에 두고, 사용하는 모든 버전의 컴포넌트에 대한 사전 조사를 철저히 해야 한다.

<br>

## 참고
- 실무에 바로 적용하는 해킹방어를 위한 JAVA 시큐어코딩
