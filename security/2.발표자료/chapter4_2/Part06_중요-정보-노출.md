# 중요 정보 노출
## 암호화 정책과 안전한 DB 데이터 관리
### 암호화 정책이란?
다음과 같은 내용을 총체적으로 이르는 표현이다.

- 암호화 대상 시스템 정의
- 암호화 대상 정보 정의
- 암호화 정책(부분암호화 적용 여부, 암호 알고리즘 등) 정의
- 암호화 방식(API, Plug-In(UDF Only 포함), Hybrid 등) 정의
- 접근제어, 감사로그 적용 대상 정의

주로 프로그램 개발 역할군 중에서는 프로젝트 책임자(PM)가, 프로그램 개발 단계 중 '분석/설계 단계'에서 정한다.

### 암호화 방식
- 대칭키 암호화
   - 전송하고자 하는 평문을 암호화하고 복호화하는 데 동일한 키를 사용하는 방식
- 비대칭키 암호화
- 일방향 암호화
   - 해시함수를 이용해 암호화된 값을 생성
   - 해시함수를 사용하더라도 솔트(salt: 해시함수로 도출된 데이터에 특정한 값을 추가하여 보안성을 강화하는 기법)값을 추가하지 않으면 노출 가능성이 증가한다.

### 암호화 알고리즘 종류
- SHA-224/256/384/512
   - 해시함수 이용
- AES-127/196/256
   - DES의 뒤를 잇는 암호 기술 표준
   - 대칭키 암호화 알고리즘
- RSA
   - MIT에서 개발한 공개키 암호화 알고리즘
   - 소인수분해의 어려움에 안전성의 기반을 둠
- ARIA-127/192/256
   - 대칭키 방식의 국가 암호화 알고리즘
- SEED
   - 순수 국내기술로 개발된 대칭키 암호 알고리즘

### DB 암호화시 안전한 키 관리대책 4가지
1. 암호화 키는 절대로 키 관리 서버를 떠나서는 안 된다.
   - 데이터 암호화에 사용되는 키와 키 자체를 암호화하는 마스터 키 모두 DB 서버의 파일 시스템은 물론 메모리에도 존재하지 않아야 한다. DB서버가 장악됐을 때 암호화 키도 유출될 수 있기 때문이다.
2. 암호화 키는 외부 공격으로부터 키를 안전하게 보호할 수 있는 곳에 보관되어야 한다.
   - 해커가 DB서버를 경우해서 키 관리 서버 자체를 공격할 가능성도 있으므로 키를 안전하게 보호하기 위해 설계된 전용 하드웨어 어플라이언스에 키를 보관하는 것이 안전하다.
3. DB 관리자와 데이터 보안 관리자(암호화키 관리자) 계정은 반드시 분리해서 관리해야 한다.
   - 해커가 DB 관리자 계정을 탈취하면 암호화 키에 대한 접근 권한까지 같이 획득하게 될 가능성을 사전에 방지한다. 두 계정을 별도의 계정으로 관리하여, DB 관리자라 하더라도 암호화된 데이터의 원래 내용을 볼 수 없도록 권한을 제한해야 한다.
4. DB 암호화 적용 시에는 반드시 얼마나 안전한가를 고려해야 한다.
   - 안전성의 기준은 암호화 키를 데이터와 분리하여 관리한다는 것이다.
   - 암호화키 관리의 가장 중요한 원칙은 암호화키와 암호화 데이터를 분리해서 보관해야 하는 것이다.
   - 별도 키 관리 시스템을 구축하고 해당 시스템의 접근통제를 강화할 필요가 있다.

<br>

## 민감한 데이터 노출
로그인 또는 실명인증 시 민감한 데이터가 평문으로 송수신될 경우, 공격자가 감청(sniffing)을 통해 다른 사용자의 민감한 데이터를 획득할 수 있는 취약점이다. 일반적으로 공격자는 암호화 알고리즘 자체를 공격하지 않고, 키 유출, 중간자 공격, 복호화된 정보, 전송된 정보 가로채기 등을 통한 공격을 수행한다.

보통 다음과 같은 프로세스로 공격이 진행된다.

1. 클라이언트에서 서버에게 민감한 데이터를 요청한다.
2. 서버에서 요청에 대한 응답을 보낸다.
3. 공격자가 서버에서 보낸 응답을 감청한다.
4. 클라이언트가 서버의 응답을 받는다.

암호화 단계의 부재나 취약점이 있는 암호화 방식을 적용했을 경우에 발생하는 문제점으로, 대응 방법은 다음과 같다.

1. 민감한 데이터 전송 시 안전하게 암호화하여 전송한다.
   - 안전한 통신 채널 사용
   - '암호연산' 요구 항목을 충족시키는 암호화 알고리즘이나 암호키 사용
2. 쿠키에 포함되는 중요 정보는 암호화하여 전송한다.
   - 쿠키에는 중요정보가 포함되지 않도록 설계해야 하나, 부득이하게 쿠키에 중요정보가 포함되어야 하는 경우, 반드시 세션 쿠키로 설정되어야 하고, 전달되는 중요 정보는 반드시 암호화하여 전송해야 한다.
3. 보안 서버를 적용한다.
   - 서버와 클라이언트 통신 시 중요정보가 사용되는 구간에 SSL 등 암호화 통신을 적용한다.
   - **SSL(Secure Sockets Layer)** 란 웹 서버 인증, 서버 인증이라 불리는 프로토콜을 말하며, 클라이언트와 서버 간 통신에서 정보를 암호화하기 때문에 감청당하더라도 정보의 내용을 보호할 수 있는 보안 솔루션을 말한다.

비밀번호 정보를 전송해야 하는 경우, 다음과 같이 시큐어 코딩을 적용할 수 있다.

```java
char[] passwordArr = password.toCharArray();
String encrypted = "";

try {
  // 암호화 알고리즘 선택
  MessageDigest md = MessageDigest.getInstance("SHA-512");
  md.reset();
  // UTF-8 인코딩
  md.update(new String(passwordArr).getBytes("UTF-8"));
  // 선택한 알고리즘으로 암호화하고, 암호화된 비밀번호를 인코딩
  encrypted = String.format("%0128x", new BigInteger(1, md.digest()));
} catch(Exception e) {
  ...
}
```


<br>

## 참고
- KISA - 홈페이지 취약점 진단·제거 가이드.pdf
- 한국인터넷진흥원 - 개인정보의 암호화 조치 안내서.pdf
- <https://www.boannews.com/media/view.asp?idx=45396>
- <https://cocomo.tistory.com/301?category=681263>
- <http://gsinfo.kr/xe/SecureCoding_Board/1639>
- <http://oliviertech.com/ko/java/generate-SHA256--SHA512-hash-from-a-String/>
