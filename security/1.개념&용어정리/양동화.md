## 개념 & 용어정리

## 목차
- [XSS(크로스 사이트 스크립팅, cross-site scripting)](#xss크로스-사이트-스크립팅-cross-site-scripting)
- [SQL Injection(SQL 삽입, SQL 주입)](#sql-injectionsql-삽입-sql-주입)
- [CSRF(사이트 간 요청 위조, cross-site request forgery, XSRF)](#csrf사이트-간-요청-위조-cross-site-request-forgery-xsrf)
- [안전하지 않은 리다이렉트와 포워드](안전하지-않은-리다이렉트와-포워드)
- [널 포인터 역참조](#널-포인터-역참조)
- [정수 오버플로우(Integer Overflow)](#정수-오버플로우integer-overflow)
- [ESAPI](#esapi)
- [침입탐지](#침입탐지)
- [액세스 제어](#액세스-제어)
- [입력값 유효성 검증(Validator)](#입력값-유효성-검증validator)

---

### XSS(크로스 사이트 스크립팅, cross-site scripting)
웹사이트의 관리자가 아닌 이가 웹 페이지에 악성 스크립트를 삽입할 수 있는 취약점이다. 주로 게시판에 악성 스크립트가 담긴 글을 올리는 형태로 이루어진다.

#### 발생 원인
사용자로부터 입력 받은 값을 제대로 검사하지 않고 사용할 경우 발생한다. 사용자가 특정 웹사이트를 신용하는 부분을 노린 공격이라고 한다.

#### 피해
사용자의 정보(세션, 쿠키 등) 탈취, 비정상적인 기능 수행

#### 공격 유형
1. 비 지속적(Non-persistent) 기법

반사(Refected) XSS라고도 불리며, 가장 일반적인 유형이다. 웹 클라이언트가 제공하는 HTTP 쿼리 매개 변수에서 적절하지 않고, 구문 분석 및 해당 사용자에 대한 결과의 페이지를 표시하는 공격 기법이며, 검증되지 않은 사용자가 URL 파라미터나 HTTP 요청 헤더 정보를 수정하여 공격할 수 있다.

2. 지속적(Persistent) 기법

공격자가 제공한 데이터가 서버에 저장 된 다음 지속적으로 서비스를 제공하는 정상적인 페이지에서 다른 사용자에게 노출된다. 사용자들이 노출된 웹사이트를 사용하면, 사용자들의 정보가 공격자에게 전송이 되어도 당사자가 공격 행위를 깨닫지 못한다. 제 3자 웹사이트로 유인할 필요 없이 자동으로 렌더링되므로 비 지속적 기법에 비해 위험하다.

#### 방어법 (OWASP의 XSS 공격 방지 7계명)
```
0. 허용된 위치가 아닌 곳에 신뢰할 수 없는 데이터가 들어가는것을 허용하지 않는다.
1. 신뢰할 수 없는 데이터는 검증을 하여라.
2. HTML 속성에 신뢰할 수 없는 데이터가 들어갈 수 없도록 하여라.
3. 자바스크립트에 신뢰할 수 없는 값이 들어갈 수 없도록 하여라.
4. CSS의 모든 신뢰할 수 없는 값에 대해서 검증하여라.
5. URL 파라미터에 신뢰할 수 없는 값이 있는지 검증하여라.
6. HTML 코드를 전체적으로 한번 더 검증하여라.
```

<br>

### SQL Injection(SQL 삽입, SQL 주입)
코드 인젝션 공격 방법 중 하나로, 응용 프로그램 보안 상의 허점을 의도적으로 이용하여 악의적인 SQL문을 실행되게 함으로써 데이터베이스를 비정상적으로 조작하는 공격이다.

`statement = "SELECT * FROM users WHERE name = '" + userName + "';"`

위와 같은 코드에서 userName이 들어가는 자리에 악의적인 코드를 삽입하여

`SELECT * FROM users WHERE name = 'a';DROP TABLE users; SELECT * FROM userinfo WHERE 't' = 't';`

이런 식으로 공격할 수 있다.

#### Blind SQL Injection
평범한 SQL Injection과 같이 원하는 데이터를 가져올 쿼리를 삽입하는 기술로, 웹에서 SQL 삽입에 취약하나 데이터베이스 메시지가 공격자에게 보이지 않을 때 사용한다.

평범한 SQL Injection은 쿼리를 삽입하여 원하는 데이터를 한 번에 얻어낼 수 있는 반면, Blind SQL Injection은 쿼리가 참일 때와 거짓일 때의 서버의 반응 만으로 데이터를 얻어내는 기술이다. 보통 자동화된 툴을 사용하여 공격한다.

#### 방어법
1. 준비된 선언(Prepared statement)
사용자의 입력이 쿼리문으로부터 분리되기 때문에 효과적으로 방어할 수 있다.

1️⃣쿼리문이 DBMS로 전송되되, 사용자 입력값은 전송되지 않고 플레이스홀더로 표시된다. 2️⃣DBMS가 쿼리문을 분석하고 최적화를 진행한다. 3️⃣플레이스홀더에 입력할 사용자 입력 값이 전송되고 DBMS가 쿼리문을 실행한다.

2. 이스케이프
SQL에서 특별한 의미를 갖는 문자들을 이스케이프한다.

<br>

### CSRF(사이트 간 요청 위조, cross-site request forgery, XSRF)
사용자가 자신의 의지와는 무관하게 공격자가 의도한 행위를 특정 웹사이트에 요청하게 하는 공격이다.

#### 발생 원인
특정 웹사이트가 사용자의 웹 브라우저를 신용하는 상태를 노린 공격이다. 사용자가 웹사이트에 로그인 한 상태에서 사이트간 요청 위조 공격 코드가 삽입된 페이지를 열면, 공격 대상이 되는 웹사이트는 위조된 공격 명령이 믿을 수 있는 사용자로부터 발생된 것으로 판단하게 되어 공격에 노출된다.

공격자가 사용자의 쿠키나 자격 증명에 접근할 필요가 없다. 즉, 사용자의 브라우저가 이 정보를 저장하고 관련 서버에 대한 모든 요청에 자동으로 포함시킨다.

#### 방어법
1. Referrer 검증

서버 측에서 request referrer를 확인하여 domain이 일치하는지 검증하는 방법이다. 대부분의 CSRF 공격을 방어할 수 있으나, 같은 도메인 내의 페이지에 XSS 취약점이 있는 경우 취약해질 수 있다. domain 단위 검증에서 페이지 단위까지 검증하면 상기한 취약점에 대해서도 방어할 수 있다.

2. Security Token 적용(CSRF Token)

Referrer 검증이 불가한 환경이라면 Security Token을 활용할 수 있다. 사용자의 세션에 임의의 난수 값을 저장하고 사용자의 요청마다 해당 난수 값을 포함시켜 전송한다. 이후 서버 단에서 요청을 받을 때마다 세션에 저장된 토큰 값과 요청 파라미터에 전달되는 토큰 값이 일치하는지 검증한다. 이 방법 역시 같은 도메인 내에 XSS 취약점이 있다면 취약해진다.

<br>


### 안전하지 않은 리다이렉트와 포워드
#### 검증되지 않은 리다이렉트
`response.sendRedirect("http://www.mysite.com");`

`response.sendRedirect(request.getParameter("url"));`

사용자가 넘겨준 매개변수로 각 언어별로 리다이렉트 처리 시 취약점이 발생하여 악의적 URL로 렌더링 될 수 있다는 취약점이다.

#### 검증되지 않은 포워드
리다이렉트와 마찬가지로 사용자에게 전달받은 값으로 포워딩을 해서 발생하는 취약점이다. 접근제어를 우회하는 방식으로 공격된다.

Spring Security의 보안 필터가 include나 forward 시 보안 제약 조건이 동작하지 않으므로 발생하는 것으로,
<<<미완>>>

<br>

### 널 포인터 역참조
null값을 가지는 참조 변수를 사용해 객체의 속성이나 메소드를 사용하는 경우 NullPointerException이 발생한다. 파라미터 값이 null인지 체크해주는 로직이 존재하지 않는다면 예외가 발생한다.

취약점을 제거하기 위해 null이 될 수 있는 레퍼런스는 참조하기 전에 null인지 검사한다.

<br>

### 정수 오버플로우(Integer Overflow)
정수값이 허용된 가장 큰 값보다 더 커져서 실제 저장되는 값은 의도하지 않게 아주 작은 수이거나 음수가 되어 프로그램이 예기치 않게 동작될 수 있는 취약점이다.

대부분의 컴파일러에서 오버플로우를 무시하기 때문에 잘못된 값이 저장될 수 있으며, 이로 인해 다른 종류의 버그를 초래할 수 있다. 또한 발견하기 어렵기 때문에 에러 검사 코드에 검출되지 않는 경우도 있다.

취약점을 제거하기 위해 범위를 체크하는 모듈을 사용하여 지정된 범위 밖의 입력이 들어오지 못하도록 한다.

<br>

### ESAPI

<br>

### 침입탐지

<br>

### 액세스 제어

<br>

### 입력값 유효성 검증(Validator)

<br>

---

## 참고 사이트
- [위키백과](https://ko.wikipedia.org/wiki/%EC%9C%84%ED%82%A4%EB%B0%B1%EA%B3%BC:%EB%8C%80%EB%AC%B8)
- [Website Security](https://developer.mozilla.org/ko/docs/Learn/Server-side/First_steps/Website_security)
- <https://itstory.tk/entry/CSRF-%EA%B3%B5%EA%B2%A9%EC%9D%B4%EB%9E%80-%EA%B7%B8%EB%A6%AC%EA%B3%A0-CSRF-%EB%B0%A9%EC%96%B4-%EB%B0%A9%EB%B2%95>
- <https://cocomo.tistory.com/305>
- <https://i2sec.github.io/2017/03/30/owasp_top_10_forward.html>
