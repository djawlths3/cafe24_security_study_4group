# SQL 인젝션
- 클라이언트의 입력값을 조작하여 서버의 데이터베이스를 공격할 수 있는 공격방식
- 주로 사용자가 입력한 데이터를 제대로 필터링, 이스케이핑하지 못했을 경우에 발생

### 주 공격 방법
- SQL Injection이 되는지는 큰따옴표나 작은따옴표를 input 태그 같은 곳에 넣어서 SQL 에러를 보여주는지 확인하면 된다.
- HTTP 헤더를 보고 응답 헤더에 서버의 종류와 버전을 확인한 후 해당 시스템에 맞는 명령어를 이용해 공격할 수 있다.
- 블라인드 SQL 인젝션은 에러메시지가 해커 입장에서 아무런 도움이 되지 않거나 아예 에러페이지를 보여주지 않을 경우 주로 사용하는 기법이다. 
  - 대표적으로 시간 지연 공격이 있는데, 간단하게 몇 초 정도의 딜레이를 이용해 원하는 시간 만큼 데이터베이스가 움직여 준다면 취약점이 있다고 판단할 수 있다.

### 방어 방법
- 기본적으로 유저에게 받은 값을 직접 SQL로 넘기지 않도록 한다.
- DB에 유저별로 접근 권한과 사용 가능한 명령어를 설정하여 최악의 경우에 SQL 인젝션이 성공하더라도 그나마 피해를 최소화할 수 있도록 한다.
- DB엔진별로 문법이 다 다르기 때문에 개발자가 모든 엔진을 고려하여 코딩하는 방법은 비추천 되며, 엔진에서 제공하는 prepared statement를 사용하는 방법이 좋다.
- 웹 사이트에서 자바스크립트로 한 번 검증하고, 서버 측은 클라이언트 측의 자바스크립트 필터가 없다고 가정하고 한 번 더 입력값을 필터하도록 한다.
  - 정규 표현식과 prepared statement, 프로시저를 적극 활용하도록 한다.
- google hacking을 이용해 검색 결과가 나오지 않도록 잘 설정한다.
  - google hacking 패턴 예제 : inurl:/admin/login+filetype:asp | sql + site:co.kr
  - intitle:admin inurl:.com/login.aspx

# 운영체제 명령 실행
- system(), exec() 등과 같은 시스템 명령어를 실행시킬 수 있는 함수를 제공하며 사용자 입력 값에 대한 필터링이 제대로 이루어지지 않을 경우 공격자가 운영체제 시스템 명령어를 호출하여 백도어 설치나 관리자 권한 탈취 등 시스템 보안에 심각한 영향을 미칠 수 있는 취약점

### 주 공격 방법
- 주로 URL의 파라미터에 몇 가지 명령어를 삽입해 보면서 취약점을 확인한다.
- URL의 파라미터에 ls, cat 등의 명령어를 삽입해 보거나, dir, ipconfig 등의 명령어를 삽입해 본다.
- 간단한 공격 패턴들의 예제는 다음과 같다.
- http://sensitive/cgi-bin/userData.pl?doc=user1.txt
- http://sensitive/cgi-bin/userData.pl?doc=/bin/ls|
- http://sensitive/something.php?dir=%3Bcat%20/etc/passwd

# XPath 삽입
- XML 데이터에 대한 Xpath 쿼리를 구성 할 때 발생 한다. 의도적으로 조작 된 정보를 웹 사이트에 전송함으로써 공격자는 XML 데이터의 구조를 알 수 있으며 일반적으로 접근할수 없는 데이터에 접근을 할 수 있다.
- 주 공격방법은 SQL Injection과 비슷하게 URL 파라미터나 input 태그 값에 따옴표 등의 특수 문자를 넣어 보는 방법이 주로 사용된다.

# LDAP 삽입
- LDAP
  - 경량 디렉터리 액세스 프로토콜(Lightweight Directory Access Protocol; LDAP)은 TCP/IP 위에서 디렉터리 서비스를 조회하고 수정하는 응용 프로토콜이다.
  - 가장 일반적인 예로는 전화 번호부가 있는데 가나다 순의 일련의 이름을 가지고 있고, 이름마다 전화 번호와 주소가 포함되어 있다.
  - 이러한 기본 설계 때문에 LDAP는 인증을 위한 다른 서비스에 의해 자주 사용된다.
- LDAP 삽입은 LDAP 쿼리를 주입해서 개인정보 등의 내용이 유출될 수 있는 문제를 이용하는 취약점이다.
- 일부 웹사이트에서 사용자 입력 부분을 LDAP 쿼리로 수행하고, 입력값 필터링을 제대로 처리하지 못할 경우 LDAP 구문을 변경하여 개인정보 등의 내용을 취득할 수 있다

### 주 공격 방법
- LDAP에서 와일드 문자로 사용되는 * 기호를 입력하여 반환되는 데이터 량의 변화를 확인한다.
- [*);cn;], [*));cn;], [*)));cn;], [*)));cn;]의 방법으로 ) 기호를 추가하여 에러가 발생하는지 확인한다.

### 방어 방법
- 사용자 입력값을 White List로 지정하여 영문(a-z, A-Z)과 숫자(0-9)만을 허용한다.
- DN과 필터에 사용되는 사용자 입력값에는 특수문자가 포함되지 않도록 특수문자를 제거한다.
- 특수문자를 사용해야 하는 경우 특수문자(DN에 사용되는 특수문자는 '\', 필터에 사용되는 특수문자는 =, +, <, >, #, ;, \ 등)에 대해서는 실행 명령이 아닌 일반문자로 인식되도록 처리한다.

# SOAP 삽입
- SOAP
  - Simple Object Access Protocol로 XML 언어를 이용하여 분산환경에서의 정보 교환을 해주는 프로토콜이다.
  - HTTP, HTTPS, SMTP를 통하여 XML 기반의 메시지가 네트워크에서 교환된다. 언어/OS와 독립적이고, 물리적으로 인접하지 않은 서버에 정보를 요청하고 요청에 대한 응답 값을 확인할 수 있다.
- SOAP는 XML을 사용하고 XML은 해석 언어이기 때문에 취약점이 발생할 수 있다.
- 공격자가 <> 및 / 또는 SOAP 메시지에 메타 캐릭터를 삽입 할 수 있으면 응용 프로그램의 논리를 방해 할 수 있다.

### 주 공격 방법
- 각 매개 변수에 </foo> 같은 태그를 삽입해 봄으로써 오류가 발생하는지 확인한다.
- 사실상 해당 취약점은 발견하기가 매우 어렵고, 악용하기가 어렵다.
- 태그에 이용되는 특수 문자가 삽입되면 적절하게 필터하고, 에러 페이지가 나타나지 않도록 한다.

# XSS 공격
- Cross-Site Scripting 공격으로 공격자가 브라우저에 악성 스크립트가 실행되도록 하는 기법이다.

### 주 공격 방법
- Stored XSS ( Persistent XSS )
  - 인증된 사용자 중 악의적인 목적을 가진 사용자가 자신이 작성하는 게시글 등에 악성 스크립트를 작성하여 글을 작성하면 해당 글을 읽는 제3의 방문자의 브라우저에서 악성 스크립트가 수행될 수 있다.
- Reflected XSS ( Non-Persistent XSS )
  - URL의 파라미터에 악성 스크립트를 심어놓고, 서버에 보내면 서버는 이 스크립트 부분을 다시 브라우저에 보내어 실행되도록 한다.
  - 즉, 브라우저에서 사용자가 입력한 내용이 서버로부터 즉각적으로 다시 자신에게 반환되는 경우에 발생되는 공격이다.
  - 예를 들어, 공격자가 목표로 하는 대상자에게 이메일을 보내어, 이메일 내용에 포함된 URL 주소를 클릭 하도록 유도 한다. 이후에 클릭하면, 클릭한 자의 브라우저에서 악성 스크립트가 실행된다.
- DOM-based XSS
  - 스크립트가 클라이언트 측, 즉 JavaScript 코드에 의해서 실행되어지는 공격이다.
- 주로 여러가지 스크립트 문자열을 입력해 봄으로써 취약점이 있는지 찾는다.
```js
<script> alert(document.cookie)</script>
"><script>alert(document.cookie)</script>

"><ScRiPt>alert(document.cookie)</ScRiPt>

"%3e%3cscript%3ealert(document.cookie)%3c/script%3e

"><scr<script>ipt>alert(document.cookie)</scr</script>ipt>

%00"><script>alert(document.cookie)</script>
```

# 정수 오버플로우
- 정수형의 크기는 고정되어 있는데, 정수형이 저장할 수 있는 값의 크기보다 큰 값을 저장할 때 예기치 않은 오류가 발생하는 취약점
- 예를 들어, 고객이 주문한 물건 가격의 합을 계산할 때 정수 오버플로우가 발생해 값이 양수에서 음수로 이동할 수 있다. 실제로 거래가 완료되면 고객에게 돈을 주는 문제가 발생할 수 있다.
- 잔고가 0 인 계정에서 1 달러를 인출하여 정수가 언더 플로우되고 4294967295의 새 잔액이 생길 수 있다.
- 은행 송금에서 매우 큰 양수는 서버에 의해 부호있는 정수로 캐스팅 될 수 있다. 이 경우 해석 된 값은 음수가 되어 피해자의 계정에서 공격자의 돈으로 돌아갈 수 있다.

### 방어 방법
- 언어, 플랫폼 별 정수 타입의 범위를 확인하여 변수를 연산에 사용하는 경우 결과값이 해당 타입의 범위 안에 있는지 체크하는 모듈 사용
- 외부 입력 값을 동적으로 할당하여 사용하는 경우 변수의 값 범위를 검사하여 적절한 범위내에 존재하는 값인지 확인

# 참고할 사이트
- https://www.boannews.com/search/news_list.asp?search=key_word&find=%C3%EB%BE%E0%C1%A1
- https://www.krcert.or.kr/data/secInfoList.do
- https://www.exploit-db.com
- https://hackingforsecurity.blogspot.com/